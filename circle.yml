machine:
  environment:
    ANDROID_BUILD_TOOLS_VERSION: 23.0.2
    ANDROID_SDK_VERSION: 23
    EMULATOR_AVD: circleci-android21
    GRADLE_ARGUMENTS: -PdisablePreDex
    TERM: dumb
  java:
    version: oraclejdk8

dependencies:
  pre:
    - echo y | android update sdk --no-ui --all --filter tools
    - echo y | android update sdk --no-ui --all --filter platform-tools,build-tools-${ANDROID_BUILD_TOOLS_VERSION},android-${ANDROID_SDK_VERSION},extra-android-m2repository

test:
  pre:
    - emulator -avd ${EMULATOR_AVD} -no-audio -no-window:
        background: true
    - circle-android wait-for-boot
  override:
    - ./gradlew clean assemble check connectedCheck ${GRADLE_ARGUMENTS}
  post:
    - find . -type f -regex ".*/build/outputs/.*xml\|.*/build/test-results/.*xml" -exec cp {} ${CIRCLE_TEST_REPORTS} \;
